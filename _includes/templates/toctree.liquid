{% assign current_product = page.dir | split: '/' | slice: 2 | first %}

<ul>
    {%- for item in workdir_files -%}
        {% assign item_product = item.dir | split: '/' | slice: 2 | first %}
        {% if item_product == current_product %}
            {%- assign level = item.dir | append: "temp" | replace_first: "/", "" | split: "/" | size -%}
            {%- capture current -%}
                {%- if page.url == item.url %}current{% endif -%}
            {%- endcapture %}
            <li class="toc level-{{ level }} {{ current }}" data-sort="{{ item.sort }}" data-level="{{ level }}">
                <a class="d-flex flex-items-baseline {{ current }}" href="{{ item.url | relative_url }}">
                    {%- if item.sort -%}
                        {{ item.sort }}. {{ item.title | default: item.name }}
                    {%- else -%}
                        {{ item.title | default: item.name }}
                    {%- endif -%}
                </a>
            </li>
        {% endif %}
    {%- endfor %}
</ul>

{%- for workdir in workdir_dirs -%}
    {% assign dir_product = workdir | split: '/' | slice: 2 | first %}
    {% if dir_product == current_product %}
        {% include templates/_toctree.liquid %}
    {% endif %}
{%- endfor -%}